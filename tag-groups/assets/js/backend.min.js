/*!
 * Last modified: 2021/09/03 13:50:24
 * Part of the WordPress plugin Tag Groups
 * Plugin URI: https://chattymango.com/tag-groups/
 * Author: Christoph Amthor
 * License: GNU GENERAL PUBLIC LICENSE, Version 3
 */
function tg_do_ajax(tg_params,send_data,labels){var nonce,data={action:"tg_ajax_manage_groups",nonce:jQuery("#tg_nonce").val()};jQuery.extend(send_data,data),send_data.tag_groups_start_position=jQuery("#tg_start_position").val(),send_data.tag_groups_filter_label=jQuery("#filter_label").val();var message_output="";jQuery("#tg_groups_container").fadeTo(200,.7),jQuery.ajax({url:tg_params.ajaxurl,data:send_data,dataType:"text",method:"post",success:function(data){try{const dataOld=data;(data=data.replace(/[^{]*{/,"{"))!==dataOld&&jQuery("#wpfooter").hide();var dataParsed=JSON.parse(data)}catch(e){return tg_display_error(e.message+"\n\n"+data.toString(),tg_params.isPremium),!1}var status=dataParsed.data,message=dataParsed.supplemental.message,nonce=dataParsed.supplemental.nonce,showParents=tg_params.show_parents||!1;if(""!==nonce&&jQuery("#tg_nonce").val(nonce),"success"===status){var groups=dataParsed.supplemental.groups,start_position=dataParsed.supplemental.start_position;""!==start_position?jQuery("#tg_start_position").val(start_position):start_position=send_data.start_position;var max_number=dataParsed.supplemental.max_number,output="";if(dataParsed.supplemental.is_filtered?jQuery("#tg_groups_container").removeClass("ui-sortable").sortable("disable"):jQuery("#tg_groups_container").addClass("ui-sortable").sortable("enable"),max_number>0||dataParsed.supplemental.is_filtered)for(var key in dataParsed.supplemental.parents_available?jQuery(".tg_group_admin_parent").css("display","block"):jQuery(".tg_group_admin_parent").css("display","none"),dataParsed.supplemental.only_parents&&!dataParsed.supplemental.is_filtered&&(output+=tg_html_first_group(labels)),groups){var data_set=groups[key];if(null!=data_set.id){showParents&&data_set.is_parent?(output+='<tr class="tg_sort_tr tg_is_parent" data-position="'+data_set.position+'">\n',output+="<td>"+data_set.id+"</td>\n",output+='<td class="tg_label_column">',output+='<span class="dashicons dashicons-networking" title="'+labels.tooltip_parent+'"></span> ',output+='<div style="display:inline-block" class="tg_edit_label tg_text tg_truncate" data-position="'+data_set.position+'" data-label="'+escape_html(data_set.label)+'">',output+=escape_html(data_set.label)+'<span class="dashicons dashicons-edit tg_pointer" style="display:none;"></span></div></td>\n',output+='<td colspan="2"></td>'):(output+='<tr class="tg_sort_tr" data-position="'+data_set.position+'">\n',output+="<td>"+data_set.id+"</td>\n",output+='<td class="tg_label_column"><div class="tg_edit_label tg_text tg_truncate tg_child_label" data-position="'+data_set.position+'" data-label="'+escape_html(data_set.label)+'" data-is_child="1">',output+=escape_html(data_set.label)+'<span class="dashicons dashicons-edit tg_pointer" style="display:none;"></span></div></td>\n',dataParsed.supplemental.parents_available&&(output+='<td class="tg_hide_when_drag"><div class="tg_truncate">'+data_set.parent_label+"</div></td>\n"),output+='<td class="tg_hide_when_drag"><div class="tg_term_amounts">',""!==tg_params.tagsurl?output+='<a href="'+tg_params.tagsurl+"&term-filter="+data_set.id+'" title="'+labels.tooltip_showtags+'">'+data_set.amount+"</a>":output+=data_set.amount+"</span>",output+="</div>",output+="</td>\n");let outputFilters="";""!==tg_params.tagsurl&&(outputFilters+='<a href="'+tg_params.tagsurl+"&term-filter="+data_set.id+'" title="'+labels.tooltip_showtags+'"><span class="tg_pointer dashicons dashicons-tag"></span></a> '),""!==tg_params.postsurl&&(outputFilters+='<a href="'+tg_params.postsurl+"&post_status=all&tg_filter_posts_value="+data_set.id+'" title="'+labels.tooltip_showposts+'"><span class="tg_pointer dashicons dashicons-admin-page"></span></a>'),output+=outputFilters?'<td class="tg_hide_when_drag">'+outputFilters+"</td>\n":"",output+='<td class="tg_hide_when_drag">',output+='<span class="tg_delete tg_pointer dashicons dashicons-trash" data-position="'+data_set.position+'" title="'+labels.tooltip_delete+'"></span>',showParents&&data_set.is_parent||(output+='<span class="tg_pointer dashicons dashicons-plus-alt" title="'+labels.tooltip_newbelow+'" onclick="tg_toggle_clear('+data_set.position+')" style="margin-left:5px;"></span>'),output+="</td>\n",output+='<td class="tg_hide_when_drag">',output+='<div style="overflow:hidden; position:relative; height:20px; clear:both;">',!dataParsed.supplemental.is_filtered&&data_set.position>1&&(output+='<span class="tg_up tg_pointer dashicons dashicons-arrow-up" data-position="'+data_set.position+'" title="'+labels.tooltip_move_up+'"></span>'),output+="</div>",output+='<div style="overflow:hidden; position:relative; height:20px; clear:both;">',!dataParsed.supplemental.is_filtered&&data_set.position<max_number&&(output+='<span class="tg_down tg_pointer dashicons dashicons-arrow-down" data-position="'+data_set.position+'" title="'+labels.tooltip_move_down+'"></span>'),output+="</div>",output+="</td>\n",output+="</tr>\n",output+='<tr class="tg_new_group_row" style="display:none;" id="tg_new_'+data_set.position+'">\n',output+='<td style="display:none;">'+labels.newgroup+"</td>\n",output+='<td colspan="5" style="display:none;"><input data-position="'+data_set.position+'"  placeholder="'+labels.placeholder_new+'">',output+='<span class="tg_new_yes dashicons dashicons-yes tg_pointer" data-position="'+data_set.position+'"></span> <span class="tg_new_no dashicons dashicons-no-alt tg_pointer" data-position="'+data_set.position+'" onclick="tg_toggle_clear('+data_set.position+')"></span>',output+="</td>\n",output+="</tr>\n"}}else output+=tg_html_first_group(labels);jQuery("#tg_groups_container").html(output);var pager_output="",page,current_page,items_per_page=Number(tg_params.items_per_page);for(items_per_page<1&&(items_per_page=1),current_page=Math.floor(start_position/items_per_page)+1,max_page=Math.floor((max_number-1)/items_per_page)+1,pager_output+=current_page>1?'<button class="button-secondary tg_pager_button" data-page="'+(current_page-1)+'" title="'+labels.tooltip_previous+'"><span class="dashicons dashicons-arrow-left-alt2"></span></button>':'<button class="button-secondary tg_pager_button" disabled><span class="dashicons dashicons-arrow-left-alt2"></span></button>',i=1;i<=max_number;i+=items_per_page)page=Math.floor(i/items_per_page)+1,pager_output+=page==current_page?'<button class="tg_reload_button tg_pointer button-secondary" id="tg_groups_reload" title="'+labels.tooltip_reload+'"><span class="dashicons dashicons-update"></span></button>':'<button class="button-secondary tg_pager_button" data-page="'+page+'" title="'+labels.tooltip_go_to_page+" "+page+'"><span>'+page+"</span></button>";current_page<max_page?pager_output+='<button class="button-secondary tg_pager_button" data-page="'+(current_page+1)+'" title="'+labels.tooltip_next+'"><span class="dashicons dashicons-arrow-right-alt2"></span></button>':pager_output+='<button class="button-secondary tg_pager_button" disabled><span class="dashicons dashicons-arrow-right-alt2"></span></button>',jQuery("#tg_pager_container").fadeOut(200,(function(){jQuery(this).html(pager_output).fadeIn(400,(function(){jQuery("#tg_pager_container_adjuster").css({height:Number(jQuery("#tg_pager_container").height())+10})}))})),message_output+=""!=message?'<div class="notice notice-success"><p>'+message+'</p></div><br clear="all" />':'<div><p>&nbsp;</p></div><br clear="all" />',jQuery("#tg_message_container").fadeTo(200,0,(function(){jQuery(this).html(message_output).fadeTo(400,1)})),jQuery("#new_parent").val("")}else""==message&&(message="Error loading data.",console.log(data)),message_output+='<div class="notice notice-error"><p>'+message+'</p></div><br clear="all" />',jQuery("#tg_message_container").fadeTo(200,0,(function(){jQuery(this).html(message_output).fadeTo(400,1)}));jQuery("#tg_groups_container").fadeTo(200,1)},error:function(xhr,textStatus,errorThrown){tg_display_error(xhr.responseText,tg_params.isPremium)}})}function tg_html_first_group(labels){let output='<tr id="tg_new_1">\n';return output+="<td ></td>\n",output+='<td colspan="4"><input data-position="0" placeholder="'+labels.newgroup+'">',output+='<span class="tg_new_yes dashicons dashicons-yes tg_pointer" data-id="1"></span></span>',output+="</td>\n",output+="</tr>\n",output}function tg_display_error(message,isPremium){let url;console.log("[Tag Groups] "+message),url=isPremium?"https://documentation.chattymango.com/documentation/tag-groups-premium/maintenance-and-troubleshooting/the-list-on-the-tag-groups-page-doesnt-load-i-only-see-the-wheel-spinning-forever-2":"https://documentation.chattymango.com/documentation/tag-groups/troubleshooting/the-list-on-the-tag-groups-page-doesnt-load-i-only-see-the-wheel-spinning-forever/",message=message.replace(/\n/g,"<br>"),message_output='<tr><td colspan="6"><div class="notice notice-error"><p>Error loading groups. Please check the error description below and read the <a href="'+url+'" target="_blank">troublshooting page</a>.<br><br>'+message+'</p><div clear="both"></div></div></td></tr>',jQuery("#tg_groups_container").fadeTo(200,0,(function(){jQuery(this).html(message_output).fadeTo(400,1)})).removeClass("ui-sortable").sortable("disable")}function tg_close_textfield(element,saved){const position=element.children(":first").attr("data-position");var label;const isChild=element.attr("data-is_child");label=escape_html(saved?element.children(":first").attr("value"):element.children(":first").attr("data-label")),isChild?element.replaceWith('<span class="tg_edit_label tg_text tg_child_label" data-position="'+position+'" data-label="'+label+'" data-is_child=1>'+label+' <span class="dashicons dashicons-edit tg_pointer" style="display:none;"></span></span>'):element.replaceWith('<span class="tg_edit_label tg_text" data-position="'+position+'" data-label="'+label+'">'+label+' <span class="dashicons dashicons-edit tg_pointer" style="display:none;"></span></span>')}function tg_toggle_clear(position){var row=jQuery("#tg_new_"+position);row.is(":visible")?(jQuery("[data-position="+position+"]").val(""),row.children().fadeOut(300,(function(){row.slideUp(600)}))):(jQuery('[id^="tg_new_"]:visible').children().fadeOut(300,(function(){jQuery('[id^="tg_new_"]:visible').slideUp(400)})),row.delay(200).slideDown(400,(function(){row.children().fadeIn(300),jQuery("[data-position="+position+"]").trigger("focus")})))}function tg_close_all_textfields(){jQuery(".tg_edit_label_active").each((function(){tg_close_textfield(jQuery(this),!1)}))}function escape_html(text){return text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}